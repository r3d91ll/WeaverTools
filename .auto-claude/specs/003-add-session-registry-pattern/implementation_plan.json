{
  "feature": "Add Session Registry Pattern",
  "description": "Create a SessionRegistry mirroring the Backend Registry pattern - manages multiple research sessions with thread-safe access, listing, and status retrieval. Enables running multiple concurrent experiments.",
  "created_at": "2025-12-26T04:17:52.200Z",
  "updated_at": "2025-12-26T04:17:52.200Z",
  "status": "in_progress",
  "planStatus": "complete",
  "workflow_type": "development",
  "services_involved": [
    "Yarn"
  ],
  "spec_file": "spec.md",
  "phases": [
    {
      "id": "phase-1",
      "name": "Core Registry Implementation",
      "description": "Implement the SessionRegistry struct and core methods following Backend Registry pattern",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Create SessionRegistry struct and constructor",
          "description": "Create the SessionRegistry struct with sessions map and sync.RWMutex. Implement NewSessionRegistry() constructor following the pattern in backend/registry.go",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "SessionRegistry struct defined with sessions map[string]*Session and mu sync.RWMutex",
            "NewSessionRegistry() returns properly initialized registry",
            "Package follows existing yarn package conventions"
          ],
          "notes": "Created Yarn/registry.go with SessionRegistry struct (sessions map[string]*Session, mu sync.RWMutex) and NewSessionRegistry() constructor. Follows Backend Registry pattern exactly. Committed as b9258f3.",
          "updated_at": "2025-12-26T04:26:17.451435+00:00"
        },
        {
          "id": "1.2",
          "title": "Implement Register method",
          "description": "Add Register(name string, session *Session) method with duplicate name detection. Uses write lock and returns error if name already exists.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Register adds session to map with write lock protection",
            "Returns error if session name already registered",
            "Returns nil on successful registration"
          ],
          "notes": "Implemented Register(name string, session *Session) method following Backend Registry pattern exactly. Uses write lock (mu.Lock/defer Unlock), returns error if session name already registered, returns nil on success. Added fmt import for error formatting. Committed as 543f362.",
          "updated_at": "2025-12-26T04:27:34.252632+00:00"
        },
        {
          "id": "1.3",
          "title": "Implement Get method",
          "description": "Add Get(name string) (*Session, bool) method to retrieve sessions by name with read lock protection.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Get returns session and true if found",
            "Get returns nil and false if not found",
            "Uses read lock for concurrent access"
          ],
          "notes": "Implemented Get(name string) (*Session, bool) method following Backend Registry pattern exactly. Uses read lock (RLock/defer RUnlock) for concurrent access. Returns session and true if found, nil and false if not found. Committed as 5dfd59a.",
          "updated_at": "2025-12-26T04:28:55.375235+00:00"
        },
        {
          "id": "1.4",
          "title": "Implement List method",
          "description": "Add List() []string method to return all registered session names.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Returns slice of all registered session names",
            "Uses read lock for concurrent access",
            "Returns empty slice when no sessions registered"
          ],
          "notes": "Implemented List() []string method following Backend Registry pattern exactly. Uses read lock (RLock/RUnlock) for thread-safe concurrent access, pre-allocates result slice with correct capacity, returns all registered session names. Returns empty slice when no sessions registered. Committed as 684fc6d.",
          "updated_at": "2025-12-26T04:30:09.967405+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Status and Enhanced Operations",
      "description": "Implement status reporting and additional registry operations",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Create SessionStatus struct",
          "description": "Define SessionStatus struct to represent session status with Name, ID, IsActive, StartedAt, EndedAt, and Stats fields.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "SessionStatus struct defined with appropriate JSON tags",
            "Includes Name, ID, IsActive, StartedAt, EndedAt fields",
            "Includes embedded or referenced SessionStats"
          ],
          "notes": "Added SessionStatus struct to Yarn/registry.go with fields: Name (string), ID (string), IsActive (bool), StartedAt (time.Time), EndedAt (*time.Time), Stats (SessionStats). All fields have appropriate JSON tags. EndedAt uses omitempty for proper nil handling. Follows Backend Registry pattern exactly. Committed as 06bf045.",
          "updated_at": "2025-12-26T04:31:39.014510+00:00"
        },
        {
          "id": "2.2",
          "title": "Implement Status method",
          "description": "Add Status() map[string]SessionStatus method to return status for all registered sessions. Copies sessions before releasing lock to avoid holding lock during stats computation.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Returns map of session name to SessionStatus",
            "Copies sessions before releasing lock (pattern from Backend Registry)",
            "Computes stats for each session"
          ],
          "notes": "Implemented Status() map[string]SessionStatus method following Backend Registry pattern exactly. Copies sessions map while holding RLock, releases lock before computing stats for each session via session.Stats(). Returns map of session name to SessionStatus with Name, ID, IsActive, StartedAt, EndedAt, and Stats fields. Committed as 1ab1cdf.",
          "updated_at": "2025-12-26T04:33:25.234814+00:00"
        },
        {
          "id": "2.3",
          "title": "Implement Active method",
          "description": "Add Active() []*Session method to return all sessions that have not ended (EndedAt is nil). Similar to Backend Registry's Available() method.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Returns slice of sessions where EndedAt is nil",
            "Properly handles concurrent access",
            "Returns empty slice when no active sessions"
          ],
          "notes": "Implemented Active() []*Session method following Backend Registry's Available() pattern exactly. Copies sessions slice while holding RLock, releases lock before filtering, returns only sessions where EndedAt == nil. Returns empty slice when no active sessions. Committed as 7afe3cc.",
          "updated_at": "2025-12-26T04:34:55.342874+00:00"
        },
        {
          "id": "2.4",
          "title": "Implement Unregister method",
          "description": "Add Unregister(name string) error method to remove a session from the registry. Returns error if session not found.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Removes session from map with write lock",
            "Returns error if session not found",
            "Returns nil on successful removal"
          ],
          "notes": "Implemented Unregister(name string) error method following Register method pattern exactly. Uses write lock (mu.Lock/defer Unlock) for thread-safe map modification, returns error if session name not found, uses delete() to remove session from map, returns nil on successful removal. Committed as 63ecc46.",
          "updated_at": "2025-12-26T04:36:19.237850+00:00"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Convenience Methods",
      "description": "Add convenience methods for common operations",
      "subtasks": [
        {
          "id": "3.1",
          "title": "Implement Create method",
          "description": "Add Create(name, description string) (*Session, error) method that creates a new session and registers it in one operation.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Creates new session using NewSession()",
            "Registers session with given name",
            "Returns created session and nil on success",
            "Returns nil and error if name already exists"
          ],
          "notes": "Implemented Create(name, description string) (*Session, error) method following existing Register method pattern exactly. Uses write lock (mu.Lock/defer Unlock), checks for duplicate names returning error if exists, creates session using NewSession(), registers it in map, returns session and nil on success. Committed as cd01475.",
          "updated_at": "2025-12-26T04:37:42.428349+00:00"
        },
        {
          "id": "3.2",
          "title": "Implement GetOrCreate method",
          "description": "Add GetOrCreate(name, description string) (*Session, bool) method that returns existing session or creates new one. Returns session and bool indicating if it was created.",
          "status": "completed",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Returns existing session and false if found",
            "Creates and returns new session and true if not found",
            "Thread-safe implementation"
          ],
          "notes": "Implemented GetOrCreate(name, description string) (*Session, bool) method following Create method pattern exactly. Uses write lock (mu.Lock/defer Unlock) for thread-safe access, returns existing session and false if found, creates new session using NewSession(), registers it in map, and returns it with true if not found. Committed as 2db73e0.",
          "updated_at": "2025-12-26T04:39:02.513037+00:00"
        },
        {
          "id": "3.3",
          "title": "Implement Count method",
          "description": "Add Count() int method to return the number of registered sessions.",
          "status": "pending",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Returns accurate count of registered sessions",
            "Uses read lock for thread safety"
          ]
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Testing",
      "description": "Comprehensive test coverage for SessionRegistry",
      "subtasks": [
        {
          "id": "4.1",
          "title": "Write unit tests for core methods",
          "description": "Test NewSessionRegistry, Register, Get, List methods with various scenarios including edge cases.",
          "status": "pending",
          "file_paths": [
            "Yarn/registry_test.go"
          ],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "Test NewSessionRegistry returns initialized registry",
            "Test Register adds session successfully",
            "Test Register returns error for duplicate names",
            "Test Get returns correct session",
            "Test Get returns false for non-existent session",
            "Test List returns all session names"
          ]
        },
        {
          "id": "4.2",
          "title": "Write unit tests for status and enhanced operations",
          "description": "Test Status, Active, Unregister methods with various scenarios.",
          "status": "pending",
          "file_paths": [
            "Yarn/registry_test.go"
          ],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "Test Status returns correct status for all sessions",
            "Test Active returns only non-ended sessions",
            "Test Unregister removes session successfully",
            "Test Unregister returns error for non-existent session"
          ]
        },
        {
          "id": "4.3",
          "title": "Write unit tests for convenience methods",
          "description": "Test Create, GetOrCreate, Count methods.",
          "status": "pending",
          "file_paths": [
            "Yarn/registry_test.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Test Create creates and registers session",
            "Test Create returns error for duplicate name",
            "Test GetOrCreate returns existing session",
            "Test GetOrCreate creates new session if not found",
            "Test Count returns accurate count"
          ]
        },
        {
          "id": "4.4",
          "title": "Write concurrency tests",
          "description": "Test thread-safety of registry operations with concurrent access patterns.",
          "status": "pending",
          "file_paths": [
            "Yarn/registry_test.go"
          ],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "Test concurrent Register operations",
            "Test concurrent Get operations",
            "Test mixed read/write operations",
            "No data races detected with -race flag"
          ]
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Integration and Verification",
      "description": "Final verification and code quality checks",
      "subtasks": [
        {
          "id": "5.1",
          "title": "Add Go doc comments",
          "description": "Add comprehensive Go documentation comments to all exported types and methods following Go conventions.",
          "status": "pending",
          "file_paths": [
            "Yarn/registry.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "All exported types have doc comments",
            "All exported methods have doc comments",
            "Comments follow Go documentation conventions"
          ]
        },
        {
          "id": "5.2",
          "title": "Run tests and verify",
          "description": "Run all tests with race detector, verify no issues, ensure code compiles cleanly.",
          "status": "pending",
          "file_paths": [
            "Yarn/registry.go",
            "Yarn/registry_test.go"
          ],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "All tests pass",
            "No race conditions detected",
            "Code compiles without warnings",
            "go vet passes"
          ]
        }
      ]
    }
  ],
  "final_acceptance": [
    "SessionRegistry struct with thread-safe map and RWMutex",
    "Core methods: NewSessionRegistry, Register, Get, List",
    "Status methods: Status, Active, Unregister",
    "Convenience methods: Create, GetOrCreate, Count",
    "Comprehensive unit tests with >80% coverage",
    "Concurrency tests pass with -race flag",
    "Pattern mirrors Backend Registry in Weaver/pkg/backend/registry.go"
  ],
  "qa_signoff": {
    "status": "pending",
    "tests_passed": "",
    "issues": ""
  },
  "metadata": {
    "total_subtasks": 15,
    "estimated_total_effort": "medium",
    "primary_language": "Go",
    "target_package": "github.com/r3d91ll/yarn",
    "pattern_reference": "Weaver/pkg/backend/registry.go"
  },
  "last_updated": "2025-12-26T04:39:02.513045+00:00"
}