{
  "feature": "Enhance error messages with context and suggestions",
  "description": "Transform generic 'Error: %v' messages into structured, actionable error displays that include: what went wrong, why it happened, and how to fix it. Use consistent color coding and formatting inspired by CLI tools like rustc, gh, and kubectl.",
  "created_at": "2025-12-26T04:18:19.101Z",
  "updated_at": "2025-12-26T04:30:00.000Z",
  "status": "in_progress",
  "planStatus": "approved",
  "phases": [
    {
      "id": "phase-1",
      "name": "Core Error Framework",
      "description": "Create the foundational error types and formatting infrastructure",
      "status": "pending",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Create errors package with structured error types",
          "description": "Create Weaver/pkg/errors/errors.go with WeaverError type containing: Code, Message, Context, Cause, and Suggestions fields. Include error categories (config, agent, backend, command, validation, etc.)",
          "status": "completed",
          "estimated_minutes": 30,
          "files": [
            "Weaver/pkg/errors/errors.go"
          ],
          "notes": "Created Weaver/pkg/errors/errors.go with WeaverError type containing Code, Message, Context, Cause, and Suggestions fields. Includes 8 error categories (config, agent, backend, command, validation, network, io, internal) and builder pattern methods for fluent API.",
          "updated_at": "2025-12-26T04:27:54.872569+00:00"
        },
        {
          "id": "1.2",
          "title": "Create error formatting and display functions",
          "description": "Create Weaver/pkg/errors/display.go with Format() function that renders errors with color coding: red for error type, yellow for context, cyan for suggestions. Support both TTY and non-TTY output.",
          "status": "completed",
          "estimated_minutes": 25,
          "files": [
            "Weaver/pkg/errors/display.go"
          ],
          "notes": "Created Weaver/pkg/errors/display.go with Format() function for color-coded error display. Includes: Format() for rendering WeaverErrors, IsTTY() for terminal detection, Formatter struct for customizable output, color constants (red for errors, yellow for context, cyan for suggestions), Sprint/Sprintc helpers, Display() convenience function, and FormatMultiple() for batch error display.",
          "updated_at": "2025-12-26T04:30:09.830397+00:00"
        },
        {
          "id": "1.3",
          "title": "Create error builder pattern for fluent API",
          "description": "Add builder methods to WeaverError: WithContext(), WithSuggestion(), WithCause() for easy error construction. Create helper constructors for common error types.",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/errors/errors.go"
          ],
          "notes": "Added 8 category-specific error constructors (ConfigError, AgentError, BackendError, CommandError, ValidationError, NetworkError, IOError, InternalError) with formatted variants (e.g., ConfigErrorf). Added 8 category-specific wrap helpers (WrapConfig, WrapAgent, etc.). Builder pattern methods (WithContext, WithCause, WithSuggestion, WithSuggestions, WithContextMap) were already present from subtask 1.1.",
          "updated_at": "2025-12-26T04:32:05.377398+00:00"
        },
        {
          "id": "1.4",
          "title": "Add unit tests for errors package",
          "description": "Create comprehensive tests for error construction, formatting, and display. Test TTY vs non-TTY output, error wrapping, and suggestion rendering.",
          "status": "completed",
          "estimated_minutes": 25,
          "files": [
            "Weaver/pkg/errors/errors_test.go",
            "Weaver/pkg/errors/display_test.go"
          ],
          "notes": "Created comprehensive unit tests for the errors package (1371 lines total):\n\nerrors_test.go (700 lines):\n- WeaverError construction (TestNew, TestWeaverError_Error)\n- Builder pattern chaining (TestWithContext, TestWithCause, TestWithSuggestion, TestBuilderChaining)\n- Error wrapping and chain inspection (TestUnwrap, TestIs, TestErrorsIs_WithWrapping)\n- Utility functions (TestHasContext, TestHasSuggestions, TestContextString, TestWrap, TestAsWeaverError, TestIsCategory, TestIsCode)\n- All 8 category-specific constructors with formatted variants\n- All 8 category-specific wrap helpers\n- Category constant verification\n\ndisplay_test.go (671 lines):\n- Formatter configuration and defaults\n- Standard error formatting for both TTY and non-TTY\n- WeaverError formatting with ANSI color codes (red, yellow, cyan, dim)\n- Context key sorting for consistent output\n- Suggestion rendering with arrow prefix\n- Sprint/Sprintc helpers for forced color modes\n- FormatMultiple for batch error display\n- CategoryLabel human-readable labels\n- Integration tests for realistic error scenarios (config, network, validation)\n\nNote: Tests require manual verification with 'go test ./pkg/errors/...' as go command was not available in this environment.",
          "updated_at": "2025-12-26T04:37:33.233788+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Error Catalog and Suggestions",
      "description": "Define standard error codes and build a suggestions database",
      "status": "pending",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Create error code constants and categories",
          "description": "Define error codes like ErrConfigNotFound, ErrBackendUnavailable, ErrAgentNotFound, ErrInvalidInput, etc. Group by category for consistent handling.",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/errors/codes.go"
          ],
          "notes": "Created Weaver/pkg/errors/codes.go with 60+ error code constants organized by category:\n\n- Configuration (6 codes): ErrConfigNotFound, ErrConfigParseFailed, ErrConfigInvalid, ErrConfigInitFailed, ErrConfigReadFailed, ErrConfigWriteFailed\n\n- Backend (9 codes): ErrBackendUnavailable, ErrBackendNotFound, ErrBackendConnectionFailed, ErrBackendAlreadyRegistered, ErrBackendTimeout, ErrBackendAPIError, ErrBackendAuthFailed, ErrBackendNotInstalled, ErrBackendStreamFailed\n\n- Agent (7 codes): ErrAgentNotFound, ErrAgentAlreadyExists, ErrAgentCreationFailed, ErrAgentNotReady, ErrAgentChatFailed, ErrAgentInvalidConfig, ErrAgentNoHiddenState\n\n- Command (6 codes): ErrCommandInvalidSyntax, ErrCommandMissingArgs, ErrCommandInvalidArg, ErrCommandNotFound, ErrCommandExecutionFailed, ErrCommandEmptyInput\n\n- Validation (5 codes): ErrValidationRequired, ErrValidationInvalidValue, ErrValidationOutOfRange, ErrValidationTypeMismatch, ErrValidationInvalidFormat\n\n- Network (5 codes): ErrNetworkTimeout, ErrNetworkConnectionRefused, ErrNetworkDNSFailed, ErrNetworkUnreachable, ErrNetworkTLSFailed\n\n- I/O (8 codes): ErrIOReadFailed, ErrIOWriteFailed, ErrIOPermissionDenied, ErrIOFileNotFound, ErrIODirNotFound, ErrIODiskFull, ErrIOMarshalFailed, ErrIOUnmarshalFailed\n\n- Internal (4 codes): ErrInternalError, ErrInternalInvariantViolation, ErrInternalNilPointer, ErrInternalPanic\n\n- Concepts/Analysis (7 codes): ErrConceptsNoHiddenState, ErrConceptsInsufficientSamples, ErrConceptsNotFound, ErrConceptsExtractionFailed, ErrAnalysisFailed, ErrAnalysisServerUnavailable, ErrAnalysisInvalidResponse\n\n- Session (3 codes): ErrSessionNotFound, ErrSessionExportFailed, ErrSessionLoadFailed\n\n- Shell (3 codes): ErrShellInitFailed, ErrShellHistoryFailed, ErrShellReadlineFailed\n\nAdded CodeCategory() lookup function and category helper functions (IsConfigCode, IsBackendCode, IsAgentCode, IsCommandCode, IsValidationCode, IsNetworkCode, IsIOCode, IsInternalCode).\n\nCreated comprehensive tests (codes_test.go) verifying code constants, category lookups, uniqueness, UPPER_SNAKE_CASE format, and integration with WeaverError helpers.\n\nNote: Tests require manual verification with 'go test ./pkg/errors/...' as go command was not available in this environment.",
          "updated_at": "2025-12-26T04:42:09.766514+00:00"
        },
        {
          "id": "2.2",
          "title": "Build suggestions registry",
          "description": "Create a map of error codes to remediation suggestions. Include context-aware suggestions (e.g., different fixes for Linux vs macOS). Support multiple suggestions per error.",
          "status": "completed",
          "estimated_minutes": 25,
          "files": [
            "Weaver/pkg/errors/suggestions.go"
          ],
          "notes": "Created Weaver/pkg/errors/suggestions.go with comprehensive suggestion registry:\n\n- Suggestion type with Text, Conditions (map for context matching), and Priority fields\n- Registry struct with methods: Register(), RegisterWithCondition(), RegisterWithPriority(), RegisterSuggestion()\n- Get() method filters suggestions based on context matching (OS, backend, arch, shell)\n- Platform detection: CurrentOS(), CurrentArch(), DefaultContext(), MergeContext()\n- Built-in suggestions registered via init() for all 60+ error codes\n- Context-aware suggestions for Linux/macOS/Windows and ClaudeCode/Loom backends\n- Helper functions: AttachSuggestions(), NewWithSuggestions(), WrapWithSuggestions()\n- FormatSuggestionList() for rendering suggestions\n\nCreated comprehensive tests (suggestions_test.go, 500+ lines):\n- Suggestion condition matching tests\n- Registry registration and retrieval tests\n- Platform detection tests\n- OS-specific and backend-specific suggestion filtering\n- Integration tests with WeaverError display\n- Coverage verification for all error codes\n\nNote: Tests require manual verification with 'go test ./pkg/errors/...' as go command was not available in this environment.",
          "updated_at": "2025-12-26T04:48:05.196194+00:00"
        },
        {
          "id": "2.3",
          "title": "Add common error constructors",
          "description": "Create helper functions like ConfigError(), BackendError(), AgentError(), CommandError() that auto-attach appropriate suggestions based on error type and context.",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/errors/constructors.go"
          ],
          "notes": "Created Weaver/pkg/errors/constructors.go with smart error constructors that auto-attach suggestions:\n\nSmart Constructors (8 categories \u00d7 4 variants = 32 functions):\n- Config(), Configf(), ConfigWrap(), ConfigWrapf()\n- Backend(), Backendf(), BackendWrap(), BackendWrapf()\n- Agent(), Agentf(), AgentWrap(), AgentWrapf()\n- Command(), Commandf(), CommandWrap(), CommandWrapf()\n- Validation(), Validationf(), ValidationWrap(), ValidationWrapf()\n- Network(), Networkf(), NetworkWrap(), NetworkWrapf()\n- IO(), IOf(), IOWrap(), IOWrapf()\n- Internal(), Internalf(), InternalWrap(), InternalWrapf()\n\nContext-Aware Constructors (8 functions):\nConfigWithContext(), BackendWithContext(), AgentWithContext(), CommandWithContext(), ValidationWithContext(), NetworkWithContext(), IOWithContext(), InternalWithContext()\n\nQuick Constructors for common error codes (17 functions):\nConfigNotFound(), ConfigParseError(), BackendNotAvailable(), BackendNotFound(), BackendNotInstalledError(), BackendConnectionError(), BackendTimeoutError(), AgentNotFound(), AgentCreationError(), AgentChatError(), CommandNotFound(), CommandMissingArgs(), CommandInvalidArg(), ValidationRequired(), ValidationInvalid(), ValidationOutOfRange(), NetworkTimeout(), NetworkConnectionRefused(), IOFileNotFound(), IOPermissionDenied(), InternalPanic()\n\nCreated comprehensive tests in constructors_test.go (786 lines) covering basic constructors, context-aware constructors, quick constructors, chaining behavior, error interface compatibility, and integration with display formatting.\n\nNote: Tests require manual verification with 'go test ./pkg/errors/...' as go command was not available in this environment.",
          "updated_at": "2025-12-26T04:52:53.006077+00:00"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Integrate with Main Entry Point",
      "description": "Update main.go to use the new error handling system",
      "status": "pending",
      "subtasks": [
        {
          "id": "3.1",
          "title": "Update config loading errors in main.go",
          "description": "Replace 'Failed to load config: %v' with structured errors that explain why config failed (missing file, parse error, invalid values) and how to fix it (run --init, check YAML syntax).",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/cmd/weaver/main.go"
          ],
          "notes": "Updated Weaver/cmd/weaver/main.go to use structured WeaverErrors for config loading failures:\n\n1. Imported werrors package (pkg/errors)\n2. Replaced \"Failed to load config: %v\" with werrors.Display(createConfigLoadError(...))\n3. Replaced \"Failed to initialize config: %v\" with werrors.Display(createConfigInitError(...))\n4. Added createConfigLoadError() helper that detects:\n   - File not found \u2192 ConfigNotFound with suggestions to run --init\n   - YAML parse errors \u2192 ConfigParseError with suggestions to check syntax\n   - Permission errors \u2192 ConfigReadFailed with path context\n   - Generic read failures with cause chain\n5. Added createConfigInitError() helper that detects:\n   - Permission errors \u2192 ConfigInitFailed with directory context\n   - Missing directories \u2192 ConfigInitFailed with mkdir suggestion\n   - Disk full \u2192 ConfigWriteFailed\n   - Generic init failures with path context\n\nAll structured errors auto-attach suggestions from the registry and display with color-coded formatting. Committed as fbffbf9.",
          "updated_at": "2025-12-26T04:55:14.784363+00:00"
        },
        {
          "id": "3.2",
          "title": "Update backend availability errors",
          "description": "Enhance the 'No backends available' error with specific suggestions for each backend type: Claude CLI installation for claudecode, Loom server status for loom.",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/cmd/weaver/main.go"
          ],
          "notes": "Enhanced 'No backends available' error in main.go with structured WeaverError. Added createBackendUnavailableError() helper function that:\n\n1. Creates WeaverError with ErrBackendUnavailable code and auto-attached suggestions\n2. Adds context about configured backends and their availability status:\n   - claudecode_status, loom_status, loom_url\n   - configured_backends summary\n3. Provides backend-specific suggestions:\n   - Claude Code: CLI installation (npm install -g @anthropic-ai/claude-cli), PATH verification, 'claude auth login' for authentication\n   - Loom: Server URL, health check command (curl URL/health), server startup guidance\n4. Includes fallback suggestions when no backends are enabled\n\nReplaces simple fmt.Println-based error output with color-coded structured error display via werrors.Display(). Committed as 68a78fa.",
          "updated_at": "2025-12-26T04:58:48.120856+00:00"
        },
        {
          "id": "3.3",
          "title": "Update agent creation errors",
          "description": "Improve agent creation failure messages to include which field is invalid, what valid options are, and example configurations.",
          "status": "completed",
          "estimated_minutes": 15,
          "files": [
            "Weaver/cmd/weaver/main.go"
          ],
          "notes": "Added createAgentCreationError() helper function in Weaver/cmd/weaver/main.go that provides structured error messages for agent creation failures. The function:\n\n1. Detects specific error types:\n   - Agent already exists \u2192 ErrAgentAlreadyExists with unique name guidance\n   - Backend not found \u2192 ErrAgentInvalidConfig with valid backend options (loom, claudecode)\n   - Invalid role \u2192 ErrAgentInvalidConfig with valid role options and role descriptions\n   - Tools incompatible with role \u2192 ErrAgentInvalidConfig with role/tools guidance\n   - Temperature out of range \u2192 ErrAgentInvalidConfig with valid range (0.0-2.0)\n   - top_p out of range \u2192 ErrAgentInvalidConfig with valid range (0.0-1.0)\n   - Missing required fields \u2192 ErrAgentInvalidConfig with example configuration\n\n2. Includes context for each error:\n   - agent name, invalid_field, invalid_value, valid_options/valid_range\n\n3. Provides actionable suggestions with example YAML configurations\n\n4. Falls back to generic ErrAgentCreationFailed with full context for unknown failures\n\nReplaced simple fmt.Printf error output on line 187 with werrors.Display(createAgentCreationError(...)).\n\nCommitted as 6c0b73e.",
          "updated_at": "2025-12-26T05:01:20.154795+00:00"
        },
        {
          "id": "3.4",
          "title": "Update shell creation and run errors",
          "description": "Enhance shell initialization errors with context about readline setup, history file permissions, etc.",
          "status": "completed",
          "estimated_minutes": 15,
          "files": [
            "Weaver/cmd/weaver/main.go"
          ],
          "notes": "Added createShellInitError() and createShellRunError() helper functions in Weaver/cmd/weaver/main.go that transform generic shell error messages into structured WeaverErrors with rich context and actionable suggestions.\n\nShell initialization errors (createShellInitError) now detect and provide guidance for:\n- History file permission issues \u2192 ErrShellHistoryFailed with chmod/ownership fix suggestions\n- History directory not found \u2192 ErrShellHistoryFailed with mkdir suggestions  \n- Disk full/quota exceeded \u2192 ErrShellHistoryFailed with cleanup suggestions\n- Readline/terminal setup issues \u2192 ErrShellReadlineFailed with TERM env and TTY requirements\n- Invalid terminal or not a TTY \u2192 ErrShellReadlineFailed with Docker -it flag, script guidance\n- Signal interruption during init \u2192 ErrShellInitFailed with restart guidance\n\nShell runtime errors (createShellRunError) now detect and provide guidance for:\n- EOF/closed input stream \u2192 ErrShellReadlineFailed with non-interactive usage tips\n- Signal interruption \u2192 ErrShellInitFailed with graceful exit suggestions (/quit, /exit)\n- Readline errors during execution \u2192 ErrShellReadlineFailed with terminal config checks\n- Terminal I/O errors \u2192 ErrShellReadlineFailed with reconnection guidance\n- Generic errors \u2192 ErrShellInitFailed with restart and reporting suggestions\n\nUpdated main.go lines 241-248 to use werrors.Display() instead of fmt.Printf for structured, color-coded error output. Committed as 6c3bc2d.",
          "updated_at": "2025-12-26T05:04:33.210403+00:00"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Integrate with Shell Commands",
      "description": "Update shell.go error handling for all commands",
      "status": "pending",
      "subtasks": [
        {
          "id": "4.1",
          "title": "Update shell error display loop",
          "description": "Replace 'Error: %v' in Run() with errors.Display() that properly formats WeaverError types and falls back gracefully for standard errors.",
          "status": "completed",
          "estimated_minutes": 15,
          "files": [
            "Weaver/pkg/shell/shell.go"
          ],
          "notes": "Updated shell.go Run() method to use structured error formatting:\n\n1. Added werrors import for pkg/errors (line 16)\n2. Replaced fmt.Printf(\"Error: %v\\n\", err) with werrors.Display(err) for command errors (line 110)\n3. Replaced fmt.Printf(\"Error: %v\\n\", err) with werrors.Display(err) for message handling errors (line 117)\n\nThe werrors.Display() function from the errors package:\n- Properly formats WeaverError types with color-coded output (red for error code, yellow for context, cyan for suggestions)\n- Falls back gracefully to \"Error: message\" for standard errors\n- Detects TTY automatically to enable/disable ANSI colors\n\nCommitted as 7e00720.",
          "updated_at": "2025-12-26T05:06:55.137239+00:00"
        },
        {
          "id": "4.2",
          "title": "Enhance message handling errors",
          "description": "Update handleMessage() errors for @agent prefix parsing, agent not found, and chat failures with context-aware suggestions.",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/shell/shell.go"
          ],
          "notes": "Updated handleMessage() in Weaver/pkg/shell/shell.go with structured WeaverErrors for three error cases:\n\n1. createMissingMessageError(): When no message follows @agent prefix\n   - Uses COMMAND_INVALID_SYNTAX code\n   - Context: agent name, attempted input\n   - Suggestions: usage example, /agents command reference\n\n2. createAgentNotFoundError(): When specified agent doesn't exist\n   - Uses AgentNotFound() constructor from werrors\n   - Context: agent name, available agents list\n   - Suggestions: available agents, typo check, /agents command\n\n3. createChatError(): When agent.Chat() fails\n   - Detects 7 specific error types:\n     * Connection refused \u2192 backend running suggestions\n     * Timeout \u2192 simplify request suggestions\n     * Auth errors (401, unauthorized) \u2192 credential suggestions\n     * Rate limits (429) \u2192 wait and retry suggestions\n     * Model not found \u2192 config check suggestions\n     * Context canceled \u2192 retry suggestions\n     * Default \u2192 generic troubleshooting\n   - Context: agent name, backend name\n   - Wraps original error with cause chain\n\nAll errors display with color-coded formatting via werrors.Display(). Committed as 9ee80ae.",
          "updated_at": "2025-12-26T05:10:12.597888+00:00"
        },
        {
          "id": "4.3",
          "title": "Enhance /extract command errors",
          "description": "Update handleExtract() with rich errors for invalid count, no hidden state agent, extraction failures. Include example usage and valid ranges.",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/shell/shell.go"
          ],
          "notes": "Updated handleExtract() in Weaver/pkg/shell/shell.go with structured WeaverErrors for all error cases:\n\n1. createInvalidCountError(): For non-numeric count argument\n   - Uses ErrCommandInvalidArg code\n   - Context: command, argument, invalid_value, concept, valid_range\n   - Suggestions: valid range, example usage, default behavior\n\n2. createCountOutOfRangeError(): For count <= 0 or > 100\n   - Uses ErrValidationOutOfRange code\n   - Context: command, argument, value, concept, valid_range\n   - Suggestions: valid range, example, recommended sample counts\n\n3. createNoHiddenStateAgentError(): When no agent supports hidden states\n   - Uses ErrAgentNoHiddenState code\n   - Context: available_agents, command, required_capability\n   - Suggestions: Loom backend, /agents command, hidden state requirements\n\n4. createExtractionError(): For extraction failures with 5 specific detection cases:\n   - Connection refused \u2192 backend running suggestions\n   - Timeout \u2192 smaller sample count suggestions\n   - Hidden state unavailable \u2192 backend capability suggestions\n   - Context canceled \u2192 retry suggestions\n   - Default \u2192 generic troubleshooting\n\nAll errors display with color-coded formatting via werrors.Display(). Committed as a973957.",
          "updated_at": "2025-12-26T05:13:11.262248+00:00"
        },
        {
          "id": "4.4",
          "title": "Enhance /analyze and /compare errors",
          "description": "Update handleAnalyze() and handleCompare() with helpful errors for missing concepts, insufficient samples, and analysis server failures.",
          "status": "completed",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/shell/shell.go"
          ],
          "notes": "Updated handleAnalyze() and handleCompare() in Weaver/pkg/shell/shell.go with structured WeaverErrors for all error cases:\n\n1. createConceptNotFoundError(): When concept is not in store\n   - Uses ErrConceptsNotFound code\n   - Context: command, concept, available_concepts\n   - Suggestions: list of available concepts, /extract usage, /concepts command\n\n2. createInsufficientSamplesError(): When concept has < 3 samples\n   - Uses ErrConceptsInsufficientSamples code\n   - Context: command, concept, current_samples, required_samples\n   - Suggestions: sample count guidance, /extract more samples, /concepts command\n\n3. createAnalysisError(): For /analyze server failures (6 detection cases)\n   - Connection refused \u2192 ErrAnalysisServerUnavailable with TheLoom guidance\n   - Timeout \u2192 ErrAnalysisFailed with smaller sample suggestions\n   - EOF/incomplete \u2192 ErrAnalysisInvalidResponse with server crash guidance\n   - Invalid/parse \u2192 ErrAnalysisInvalidResponse with version mismatch check\n   - Context canceled \u2192 ErrAnalysisFailed with retry suggestion\n   - Default \u2192 ErrAnalysisFailed with generic troubleshooting\n\n4. createComparisonError(): For /compare server failures (6 detection cases)\n   - Connection refused \u2192 ErrAnalysisServerUnavailable\n   - Timeout \u2192 ErrAnalysisFailed with smaller samples suggestion\n   - Dimension mismatch \u2192 ErrAnalysisFailed with re-extract guidance\n   - EOF/incomplete \u2192 ErrAnalysisInvalidResponse\n   - Context canceled \u2192 ErrAnalysisFailed with retry\n   - Default \u2192 ErrAnalysisFailed with generic troubleshooting\n\nAll errors display with color-coded formatting via werrors.Display(). Committed as d08bc1e.",
          "updated_at": "2025-12-26T05:17:18.470033+00:00"
        },
        {
          "id": "4.5",
          "title": "Enhance /validate and /metrics errors",
          "description": "Update handleValidate() and handleMetrics() with structured errors including iteration limits, sample requirements, and API status.",
          "status": "completed",
          "estimated_minutes": 15,
          "files": [
            "Weaver/pkg/shell/shell.go"
          ],
          "notes": "Updated handleValidate() and handleMetrics() in Weaver/pkg/shell/shell.go with structured WeaverErrors:\n\nhandleValidate() now uses structured errors for:\n- Invalid iterations value (non-numeric) \u2192 createInvalidIterationsError()\n- Iterations out of range (<=0 or >20) \u2192 createIterationsOutOfRangeError()\n- No hidden state agent \u2192 createNoHiddenStateAgentError() (reused from /extract)\n- Insufficient successful iterations (<2) \u2192 createInsufficientIterationsError()\n\nhandleMetrics() now uses structured errors for:\n- Concept not found \u2192 createConceptNotFoundError() (reused from /analyze)\n- Insufficient samples (<3) \u2192 createInsufficientSamplesError() (reused)\n- Analysis failure \u2192 createMetricsAnalysisError() (new)\n\nAdded 4 new error helper functions with context and suggestions:\n- createInvalidIterationsError(): Command, argument, value, valid_range (1-20)\n- createIterationsOutOfRangeError(): Command, argument, value, valid_range\n- createInsufficientIterationsError(): successful_iterations, requested_iterations, required_iterations\n- createMetricsAnalysisError(): Detects 6 error types (connection, timeout, EOF, parse, canceled, generic)\n\nAll errors display with color-coded formatting via werrors.Display(). Committed as bf2614f.",
          "updated_at": "2025-12-26T05:20:40.544764+00:00"
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Backend and Runtime Errors",
      "description": "Enhance errors in backend and runtime packages",
      "status": "pending",
      "subtasks": [
        {
          "id": "5.1",
          "title": "Enhance Claude Code backend errors",
          "description": "Update claudecode.go errors to distinguish between: CLI not installed, authentication issues, API errors, timeout, and streaming failures. Add installation/auth suggestions.",
          "status": "completed",
          "estimated_minutes": 25,
          "files": [
            "Weaver/pkg/backend/claudecode.go"
          ],
          "notes": "Enhanced Weaver/pkg/backend/claudecode.go with structured WeaverErrors for all error scenarios:\n\n1. CLI not installed (ErrBackendNotInstalled):\n   - Detected via \"executable file not found\", \"no such file or directory\", \"command not found\"\n   - Suggestions: npm/brew installation commands, claude auth login\n\n2. Authentication failures (ErrBackendAuthFailed):\n   - Detected via \"unauthorized\", \"401\", \"api key\", \"authentication\", \"login required\"\n   - Suggestions: claude auth login, verify API key, check Anthropic account\n\n3. Rate limiting (ErrBackendAPIError):\n   - Detected via \"429\", \"rate limit\", \"quota exceeded\", \"too many requests\"\n   - Suggestions: wait and retry, reduce request frequency, check usage limits\n\n4. API errors (ErrBackendAPIError):\n   - Detected via \"400\", \"500\", \"502\", \"503\", \"model not found\", \"invalid request\"\n   - Suggestions: check error details, verify parameters, check Anthropic status\n\n5. Timeout (ErrBackendTimeout):\n   - Detected via context.DeadlineExceeded\n   - Suggestions: shorter prompts, simpler requests, check network\n\n6. Network errors (ErrBackendConnectionFailed):\n   - Detected via \"connection refused\", \"timeout\", \"dns\", \"unreachable\"\n   - Suggestions: check internet, verify firewall settings\n\n7. Streaming failures (ErrBackendStreamFailed):\n   - Created helpers: createStreamSetupError(), createStreamStartError(), createStreamWriteError(), createStreamCommandError()\n   - All provide context (backend, pipe_type, exit_code) and actionable suggestions\n\nAdded 5 error detection helpers and truncateStderr() utility. Committed as 7a433d5.",
          "updated_at": "2025-12-26T05:24:34.732148+00:00"
        },
        {
          "id": "5.2",
          "title": "Enhance Loom backend errors",
          "description": "Update loom.go errors for: server unreachable, model not found, GPU OOM, timeout. Include Loom server troubleshooting suggestions.",
          "status": "pending",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/backend/loom.go"
          ],
          "notes": ""
        },
        {
          "id": "5.3",
          "title": "Enhance runtime agent errors",
          "description": "Update agent.go errors for agent creation, backend lookup, and chat failures with structured context and suggestions.",
          "status": "pending",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/runtime/agent.go"
          ],
          "notes": ""
        },
        {
          "id": "5.4",
          "title": "Enhance registry errors",
          "description": "Update registry.go for backend registration conflicts and lookup failures.",
          "status": "pending",
          "estimated_minutes": 10,
          "files": [
            "Weaver/pkg/backend/registry.go"
          ],
          "notes": ""
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "Config and Validation Errors",
      "description": "Enhance configuration and validation error messages",
      "status": "pending",
      "subtasks": [
        {
          "id": "6.1",
          "title": "Enhance config loading errors",
          "description": "Update config.go Load() to provide line numbers for YAML parse errors, missing required fields, and invalid values with valid options.",
          "status": "pending",
          "estimated_minutes": 25,
          "files": [
            "Weaver/pkg/config/config.go"
          ],
          "notes": ""
        },
        {
          "id": "6.2",
          "title": "Enhance Wool validation errors",
          "description": "Update ValidationError in Wool/agent.go to include valid options, example values, and documentation links.",
          "status": "pending",
          "estimated_minutes": 20,
          "files": [
            "Wool/agent.go"
          ],
          "notes": ""
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "Concepts and Analysis Errors",
      "description": "Enhance concept extraction and analysis error messages",
      "status": "pending",
      "subtasks": [
        {
          "id": "7.1",
          "title": "Enhance concept extractor errors",
          "description": "Update extractor.go with structured errors for hidden state extraction failures, including model capabilities and troubleshooting.",
          "status": "pending",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/concepts/extractor.go"
          ],
          "notes": ""
        },
        {
          "id": "7.2",
          "title": "Enhance concept store errors",
          "description": "Update store.go with helpful errors for save/load failures including file permissions and directory structure.",
          "status": "pending",
          "estimated_minutes": 15,
          "files": [
            "Weaver/pkg/concepts/store.go"
          ],
          "notes": ""
        },
        {
          "id": "7.3",
          "title": "Enhance analysis client errors",
          "description": "Update client.go with structured errors for analysis API calls including server status, request validation, and response parsing.",
          "status": "pending",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/analysis/client.go"
          ],
          "notes": ""
        }
      ]
    },
    {
      "id": "phase-8",
      "name": "Testing and Documentation",
      "description": "Comprehensive testing and documentation",
      "status": "pending",
      "subtasks": [
        {
          "id": "8.1",
          "title": "Create integration tests for error display",
          "description": "Add tests that verify error output format, color codes, and suggestion display across different error scenarios.",
          "status": "pending",
          "estimated_minutes": 30,
          "files": [
            "Weaver/pkg/errors/integration_test.go"
          ],
          "notes": ""
        },
        {
          "id": "8.2",
          "title": "Update existing tests for new error types",
          "description": "Update existing tests that check error messages to work with the new structured error types.",
          "status": "pending",
          "estimated_minutes": 20,
          "files": [
            "Weaver/pkg/config/config_test.go",
            "Weaver/pkg/backend/backend_test.go"
          ],
          "notes": ""
        },
        {
          "id": "8.3",
          "title": "Run full test suite and verify build",
          "description": "Run go build, go test, and go vet across all packages. Fix any issues. Manually test key error scenarios.",
          "status": "pending",
          "estimated_minutes": 25,
          "files": [],
          "notes": ""
        }
      ]
    }
  ],
  "dependencies": {
    "1.2": [
      "1.1"
    ],
    "1.3": [
      "1.1"
    ],
    "1.4": [
      "1.1",
      "1.2",
      "1.3"
    ],
    "2.2": [
      "2.1"
    ],
    "2.3": [
      "2.1",
      "2.2"
    ],
    "3.1": [
      "1.4",
      "2.3"
    ],
    "3.2": [
      "3.1"
    ],
    "3.3": [
      "3.1"
    ],
    "3.4": [
      "3.1"
    ],
    "4.1": [
      "1.4",
      "2.3"
    ],
    "4.2": [
      "4.1"
    ],
    "4.3": [
      "4.1"
    ],
    "4.4": [
      "4.1"
    ],
    "4.5": [
      "4.1"
    ],
    "5.1": [
      "1.4",
      "2.3"
    ],
    "5.2": [
      "5.1"
    ],
    "5.3": [
      "5.1"
    ],
    "5.4": [
      "5.1"
    ],
    "6.1": [
      "1.4",
      "2.3"
    ],
    "6.2": [
      "6.1"
    ],
    "7.1": [
      "1.4",
      "2.3"
    ],
    "7.2": [
      "7.1"
    ],
    "7.3": [
      "7.1"
    ],
    "8.1": [
      "4.5",
      "5.4",
      "6.2",
      "7.3"
    ],
    "8.2": [
      "8.1"
    ],
    "8.3": [
      "8.2"
    ]
  },
  "estimated_total_minutes": 545,
  "workflow_type": "development",
  "services_involved": [
    "Weaver",
    "Wool"
  ],
  "notes": [
    "Error formatting follows the pattern: ERROR [Code]: Message\\n  Context: ...\\n  Suggestion: ...",
    "Colors: Red (#E74C3C) for error type, Yellow (#F39C12) for context, Cyan (#3498DB) for suggestions, Green (#27AE60) for success hints",
    "Non-TTY output omits ANSI codes for clean logs",
    "Existing ValidationError in Wool will be enhanced, not replaced",
    "Go error wrapping with %w is preserved for error chain inspection"
  ],
  "final_acceptance": [
    "All error messages display with consistent formatting",
    "Each error includes at least one actionable suggestion",
    "Color coding works correctly in TTY mode",
    "Non-TTY output is clean and readable",
    "All tests pass",
    "go vet reports no issues"
  ],
  "spec_file": "spec.md",
  "qa_status": {
    "status": "pending",
    "issues": "",
    "tests_passed": ""
  },
  "last_updated": "2025-12-26T05:24:34.732155+00:00"
}